let houseData = null;
let apartInCar = false;
let lang = [];

window.addEventListener("message", (event) => {
  switch (event.data.action) {
    case "buyMenu":
      let houseFeatures = "";
      if (event.data.houseData.features.length > 0) {
        for (let i = 0; i < event.data.houseData.features.length; i++) {
          if (event.data.houseData.features[i].exist) {
            houseFeatures += `
                            <div class="houseFeature"><i class="fas fa-check"></i>${event.data.houseData.features[i].label}</div>
                        `;
          } else {
            houseFeatures += `
                            <div class="houseFeatureNotExist"><i class="fas fa-times"></i>${event.data.houseData.features[i].label}</div>
                        `;
          }
        }
      }
      $("#bedRoomAmount").html(event.data.interiorFeatures[0]);
      $("#bathRoomAmount").html(event.data.interiorFeatures[1]);
      if (event.data.houseData.garage) {
        $("#carGarageSlotBox").css("display", "flex");
        $("#carGarageSlot").html(
          event.data.houseData.garage.replace("cargarage", "") +
            " " +
            lang["carSlots"]
        );
      } else {
        $("#carGarageSlotBox").css("display", "none");
      }
      $(".houseFeatures").html(houseFeatures);
      updateHouseData(event.data.houseData);
      openMenus("#buymenu", true);
      break;
    case "houseMenu":
      if (houseData && houseData.garage) {
        inGarage(event.data.inGarage);
      } else {
        $("#houseHouse").css("display", "none");
        $("#houseGarage").css("display", "none");
      }
      if (
        houseData &&
        !houseData.invite &&
        (houseData.myHouse || houseData.haveKeys)
      ) {
        $("#houseInvite").css("display", "flex");
      } else {
        $("#houseInvite").css("display", "none");
      }
      openMenus("#housemenu", false);
      break;
    case "apartments":
      apartInCar = event.data.inCar;
      let apertmentHtml = "";
      for (let i = 0; i < event.data.houseData.apartments.length; i++) {
        apertmentHtml += `
                    <div class="bigRedButton apartmentButton" data-apart="${event.data.houseData.apartments[i]}">
                        <div class="whiteBorderButtonText">
                            ${event.data.houseData.apartments[i]}
                        </div>
                        <div class="whiteBorderButtonIcon">
                            <svg width="39px" height="39px">
                                <path fill-rule="evenodd" fill="rgb(255, 255, 255)" d="M38.174,12.785 C37.881,12.851 37.423,12.637 37.339,13.079 C37.239,13.599 37.227,14.152 37.360,14.675 C37.420,14.909 37.711,14.855 37.910,14.899 C38.223,14.967 38.517,15.081 38.512,15.461 C38.508,15.831 38.242,16.019 37.912,16.011 C37.342,15.997 37.291,16.315 37.292,16.771 C37.301,23.492 37.300,30.212 37.294,36.932 C37.293,37.374 37.319,37.718 37.903,37.705 C38.305,37.696 38.786,37.764 38.757,38.299 C38.726,38.867 38.222,38.852 37.795,38.853 C32.600,38.854 27.404,38.854 22.208,38.854 C21.300,38.854 20.391,38.854 19.483,38.854 C13.495,38.854 7.507,38.858 1.519,38.847 C1.040,38.847 0.336,39.051 0.250,38.343 C0.164,37.630 0.856,37.742 1.317,37.682 C1.567,37.650 1.692,37.518 1.701,37.272 C1.708,37.062 1.711,36.852 1.711,36.642 C1.711,26.141 1.710,15.641 1.715,5.140 C1.716,4.575 1.763,4.046 0.928,4.110 C0.653,4.131 0.459,3.891 0.471,3.593 C0.484,3.257 0.712,3.091 1.027,3.084 C1.749,3.068 2.472,3.074 3.194,3.071 C4.456,3.066 4.336,3.177 4.342,1.884 C4.343,1.581 4.353,1.277 4.341,0.974 C4.320,0.419 4.584,0.149 5.134,0.149 C7.324,0.149 9.514,0.149 11.704,0.149 C12.227,0.149 12.464,0.447 12.488,0.936 C12.508,1.332 12.502,1.729 12.505,2.125 C12.510,3.067 12.510,3.069 13.424,3.070 C15.567,3.072 17.710,3.069 19.854,3.073 C20.062,3.074 20.276,3.081 20.475,3.135 C20.700,3.195 20.807,3.383 20.802,3.617 C20.795,3.885 20.645,4.101 20.393,4.105 C19.800,4.113 19.809,4.489 19.810,4.912 C19.817,6.872 19.841,8.833 19.798,10.792 C19.783,11.493 20.042,11.648 20.689,11.646 C26.258,11.625 31.826,11.633 37.394,11.634 C37.651,11.634 37.908,11.627 38.162,11.654 C38.491,11.689 38.763,11.842 38.767,12.211 C38.772,12.580 38.497,12.712 38.174,12.785 ZM11.164,37.125 C11.160,37.494 11.294,37.694 11.688,37.691 C12.525,37.684 13.362,37.686 14.199,37.689 C14.589,37.691 14.728,37.483 14.728,37.118 C14.723,35.511 14.718,33.905 14.731,32.298 C14.734,31.835 14.516,31.689 14.088,31.698 C13.321,31.713 12.553,31.720 11.787,31.695 C11.281,31.678 11.147,31.916 11.160,32.375 C11.182,33.142 11.165,33.911 11.167,34.680 C11.167,35.495 11.174,36.310 11.164,37.125 ZM6.528,37.148 C6.526,37.535 6.704,37.694 7.078,37.691 C7.869,37.685 8.660,37.675 9.451,37.697 C9.941,37.711 10.106,37.498 10.092,37.026 C10.068,36.258 10.085,35.489 10.085,34.720 C10.085,33.928 10.065,33.136 10.092,32.344 C10.108,31.853 9.907,31.682 9.433,31.695 C8.667,31.718 7.899,31.710 7.131,31.699 C6.738,31.693 6.523,31.818 6.526,32.256 C6.537,33.887 6.534,35.518 6.528,37.148 ZM10.789,1.309 C9.189,1.308 7.588,1.312 5.988,1.307 C5.192,1.305 5.464,1.903 5.423,2.313 C5.382,2.735 5.404,3.104 6.011,3.078 C6.798,3.044 7.588,3.070 8.376,3.070 C9.165,3.070 9.955,3.044 10.742,3.078 C11.335,3.104 11.393,2.760 11.344,2.325 C11.298,1.918 11.584,1.310 10.789,1.309 ZM17.772,4.130 C13.114,4.160 8.455,4.145 3.796,4.146 C2.879,4.146 2.875,4.149 2.875,5.080 C2.874,10.329 2.874,15.577 2.874,20.826 C2.874,25.912 2.867,30.997 2.878,36.083 C2.882,37.903 2.619,37.654 4.537,37.703 C5.180,37.720 5.390,37.492 5.378,36.855 C5.346,35.129 5.362,33.403 5.371,31.677 C5.375,30.745 5.568,30.541 6.461,30.539 C9.255,30.532 12.050,30.532 14.846,30.538 C15.712,30.540 15.886,30.729 15.890,31.631 C15.895,33.054 15.891,34.477 15.891,35.900 C15.891,37.705 15.891,37.705 17.714,37.693 C18.636,37.687 18.659,37.670 18.659,36.755 C18.661,26.188 18.654,15.620 18.672,5.053 C18.674,4.362 18.494,4.125 17.772,4.130 ZM19.798,36.804 C19.795,37.525 20.025,37.710 20.717,37.706 C25.583,37.681 30.449,37.694 35.315,37.692 C36.222,37.692 36.224,37.687 36.224,36.742 C36.225,33.454 36.224,30.167 36.224,26.879 C36.224,23.544 36.212,20.210 36.235,16.876 C36.240,16.263 36.103,16.015 35.428,16.018 C30.492,16.045 25.556,16.044 20.621,16.019 C19.960,16.016 19.800,16.242 19.802,16.867 C19.820,23.513 19.824,30.158 19.798,36.804 ZM20.595,12.782 C19.760,12.729 19.761,13.214 19.841,13.922 C19.922,14.137 19.584,14.622 20.102,14.834 C20.826,15.130 21.305,14.795 21.315,14.012 C21.317,13.850 21.302,13.686 21.317,13.526 C21.363,12.992 21.134,12.816 20.595,12.782 ZM23.789,13.867 C23.789,13.774 23.787,13.727 23.789,13.681 C23.816,13.185 23.823,12.770 23.100,12.783 C22.394,12.795 22.464,13.223 22.469,13.670 C22.471,13.833 22.466,13.995 22.470,14.158 C22.485,14.793 22.972,15.110 23.535,14.826 C23.982,14.601 23.704,14.157 23.789,13.867 ZM26.198,13.898 C26.198,13.760 26.196,13.667 26.199,13.574 C26.214,13.145 26.187,12.797 25.595,12.790 C24.973,12.782 24.922,13.138 24.942,13.602 C24.951,13.811 24.936,14.022 24.947,14.231 C24.976,14.792 25.485,15.089 25.962,14.809 C26.350,14.581 26.133,14.176 26.198,13.898 ZM28.679,14.001 C28.676,13.861 28.680,13.722 28.678,13.582 C28.670,12.860 28.354,12.611 27.686,12.823 C27.118,13.002 27.473,13.501 27.358,13.782 C27.358,13.884 27.360,13.931 27.358,13.977 C27.336,14.468 27.316,14.896 28.043,14.886 C28.742,14.876 28.689,14.454 28.679,14.001 ZM30.352,12.789 C29.554,12.790 29.810,13.359 29.758,13.735 C29.758,13.842 29.757,13.912 29.758,13.981 C29.762,14.416 29.658,14.871 30.371,14.885 C31.071,14.898 31.115,14.510 31.084,13.996 C31.074,13.835 31.068,13.670 31.084,13.509 C31.140,12.957 30.885,12.788 30.352,12.789 ZM32.893,12.783 C32.201,12.787 32.232,13.197 32.245,13.658 C32.250,13.820 32.262,13.985 32.243,14.146 C32.173,14.759 32.489,14.903 33.033,14.874 C33.841,14.831 33.467,14.217 33.568,13.886 C33.568,13.763 33.564,13.693 33.569,13.623 C33.608,13.130 33.557,12.778 32.893,12.783 ZM36.031,12.882 C35.687,12.695 35.251,12.742 34.878,12.854 C34.525,12.960 34.667,13.319 34.645,13.579 C34.628,13.786 34.657,13.997 34.639,14.204 C34.599,14.670 34.776,14.872 35.267,14.879 C36.187,14.892 36.224,14.874 36.224,13.798 C36.155,13.518 36.401,13.083 36.031,12.882 ZM21.693,26.706 C21.693,26.241 21.694,25.775 21.692,25.310 C21.689,24.798 21.943,24.524 22.452,24.515 C23.126,24.505 23.799,24.506 24.473,24.515 C24.985,24.522 25.238,24.809 25.242,25.309 C25.250,26.217 25.247,27.124 25.243,28.032 C25.242,28.611 24.921,28.875 24.365,28.880 C23.761,28.886 23.157,28.887 22.553,28.879 C21.957,28.872 21.657,28.582 21.686,27.963 C21.706,27.545 21.690,27.125 21.690,26.706 C21.691,26.706 21.691,26.706 21.693,26.706 ZM22.765,27.030 C22.699,27.589 22.959,27.740 23.488,27.737 C24.278,27.734 24.035,27.174 24.086,26.801 C24.086,26.691 24.082,26.621 24.086,26.552 C24.114,26.053 24.101,25.649 23.391,25.659 C22.688,25.670 22.764,26.103 22.768,26.545 C22.769,26.707 22.784,26.870 22.765,27.030 ZM21.699,31.225 C21.709,30.777 21.953,30.534 22.399,30.527 C23.096,30.517 23.794,30.521 24.492,30.524 C24.977,30.525 25.230,30.793 25.237,31.260 C25.252,32.214 25.252,33.169 25.232,34.123 C25.222,34.559 24.974,34.809 24.519,34.810 C23.822,34.812 23.124,34.810 22.427,34.814 C21.937,34.816 21.694,34.576 21.693,34.089 C21.691,33.623 21.693,33.157 21.693,32.692 C21.694,32.692 21.695,32.692 21.696,32.692 C21.696,32.203 21.688,31.713 21.699,31.225 ZM23.537,33.745 C24.357,33.711 23.983,33.097 24.086,32.768 C24.086,32.620 24.081,32.527 24.086,32.434 C24.110,31.959 24.108,31.572 23.421,31.579 C22.732,31.586 22.750,31.986 22.766,32.453 C22.773,32.639 22.788,32.828 22.764,33.012 C22.688,33.619 22.982,33.769 23.537,33.745 ZM24.478,22.879 C23.804,22.891 23.129,22.891 22.456,22.879 C21.950,22.870 21.691,22.600 21.692,22.085 C21.694,21.154 21.694,20.222 21.693,19.291 C21.692,18.767 21.978,18.524 22.474,18.515 C23.102,18.503 23.730,18.509 24.357,18.511 C24.962,18.512 25.252,18.822 25.247,19.423 C25.243,19.865 25.247,20.308 25.245,20.750 C25.245,21.193 25.250,21.635 25.243,22.077 C25.236,22.577 24.989,22.870 24.478,22.879 ZM24.085,20.434 C24.073,19.732 23.736,19.474 23.080,19.692 C22.524,19.878 22.885,20.372 22.768,20.652 C22.768,20.777 22.771,20.847 22.767,20.916 C22.747,21.359 22.748,21.727 23.386,21.734 C24.017,21.741 24.130,21.432 24.088,20.918 C24.074,20.758 24.088,20.595 24.085,20.434 ZM27.114,30.520 C27.742,30.524 28.369,30.529 28.997,30.517 C29.581,30.506 29.857,30.790 29.859,31.362 C29.861,31.804 29.860,32.247 29.860,32.689 C29.876,35.079 29.964,34.804 27.774,34.816 C27.681,34.817 27.588,34.817 27.495,34.816 C26.363,34.814 26.304,34.757 26.302,33.638 C26.301,32.869 26.308,32.101 26.304,31.332 C26.301,30.783 26.565,30.516 27.114,30.520 ZM27.380,32.465 C27.383,32.628 27.379,32.791 27.381,32.954 C27.388,33.688 27.688,33.929 28.369,33.718 C28.941,33.541 28.581,33.038 28.699,32.757 C28.699,32.631 28.698,32.561 28.699,32.491 C28.703,32.019 28.780,31.558 28.021,31.578 C27.322,31.596 27.371,32.010 27.380,32.465 ZM31.922,30.516 C32.550,30.529 33.179,30.524 33.807,30.520 C34.317,30.517 34.602,30.763 34.609,31.274 C34.622,32.206 34.620,33.138 34.610,34.070 C34.604,34.584 34.329,34.826 33.811,34.817 C33.160,34.805 32.508,34.805 31.857,34.817 C31.296,34.828 31.047,34.559 31.058,34.009 C31.066,33.566 31.060,33.123 31.059,32.680 C31.059,32.261 31.069,31.841 31.056,31.422 C31.038,30.818 31.294,30.503 31.922,30.516 ZM32.214,33.235 C32.214,33.578 32.381,33.723 32.727,33.741 C33.398,33.775 33.457,33.698 33.453,32.620 C33.453,32.458 33.445,32.295 33.454,32.133 C33.479,31.690 33.231,31.588 32.844,31.591 C32.467,31.594 32.202,31.675 32.212,32.122 C32.219,32.492 32.214,32.864 32.214,33.235 ZM33.889,28.864 C33.193,28.889 32.495,28.889 31.799,28.866 C31.298,28.849 31.049,28.558 31.058,28.046 C31.066,27.581 31.060,27.116 31.060,26.650 C31.061,26.208 31.063,25.766 31.060,25.324 C31.056,24.772 31.341,24.513 31.878,24.511 C32.529,24.509 33.179,24.506 33.829,24.514 C34.336,24.519 34.607,24.789 34.611,25.295 C34.619,26.226 34.618,27.157 34.609,28.087 C34.604,28.554 34.358,28.846 33.889,28.864 ZM33.451,26.223 C33.445,26.012 33.443,25.777 33.186,25.716 C32.916,25.652 32.608,25.596 32.382,25.780 C32.092,26.016 32.248,26.387 32.209,26.659 C32.209,26.769 32.210,26.839 32.208,26.908 C32.197,27.348 32.192,27.733 32.832,27.738 C33.476,27.743 33.469,27.360 33.456,26.918 C33.450,26.686 33.457,26.454 33.451,26.223 ZM33.775,22.885 C33.147,22.887 32.519,22.887 31.890,22.884 C31.311,22.882 31.044,22.586 31.057,22.009 C31.068,21.567 31.059,21.124 31.058,20.681 C31.058,20.285 31.052,19.889 31.059,19.493 C31.073,18.722 31.249,18.528 31.993,18.510 C32.598,18.496 33.203,18.503 33.808,18.518 C34.339,18.531 34.619,18.809 34.617,19.355 C34.615,20.240 34.615,21.126 34.618,22.011 C34.620,22.580 34.354,22.884 33.775,22.885 ZM33.456,20.749 C33.456,20.635 33.455,20.566 33.456,20.496 C33.460,20.069 33.508,19.658 32.851,19.658 C32.227,19.657 32.190,20.014 32.207,20.471 C32.215,20.679 32.200,20.888 32.212,21.096 C32.243,21.643 32.767,21.940 33.232,21.660 C33.614,21.429 33.387,21.025 33.456,20.749 ZM27.084,24.514 C27.734,24.506 28.384,24.509 29.035,24.511 C29.575,24.512 29.851,24.788 29.857,25.328 C29.862,25.770 29.858,26.212 29.858,26.654 C29.857,27.119 29.862,27.585 29.855,28.050 C29.848,28.545 29.605,28.854 29.099,28.868 C28.403,28.887 27.705,28.888 27.010,28.860 C26.542,28.842 26.302,28.565 26.304,28.084 C26.309,27.153 26.306,26.222 26.306,25.292 C26.307,24.773 26.580,24.520 27.084,24.514 ZM28.042,27.744 C28.718,27.740 28.720,27.358 28.699,26.888 C28.692,26.727 28.683,26.563 28.701,26.404 C28.768,25.806 28.474,25.644 27.924,25.669 C27.121,25.705 27.474,26.308 27.381,26.642 C27.381,26.763 27.384,26.833 27.380,26.902 C27.349,27.380 27.369,27.748 28.042,27.744 ZM27.711,22.889 C27.502,22.888 27.292,22.889 27.084,22.882 C26.583,22.864 26.306,22.620 26.306,22.100 C26.306,21.169 26.308,20.237 26.305,19.306 C26.303,18.787 26.572,18.526 27.072,18.516 C27.723,18.503 28.374,18.506 29.025,18.515 C29.556,18.523 29.846,18.799 29.855,19.338 C29.863,19.804 29.856,20.269 29.856,20.735 C29.873,23.046 30.012,22.897 27.711,22.889 ZM28.698,20.432 C28.686,19.732 28.346,19.473 27.692,19.692 C27.137,19.879 27.498,20.373 27.381,20.653 C27.381,20.778 27.384,20.847 27.380,20.917 C27.359,21.361 27.361,21.728 28.000,21.734 C28.630,21.740 28.743,21.431 28.701,20.917 C28.687,20.757 28.701,20.594 28.698,20.432 ZM16.436,22.881 C15.786,22.888 15.136,22.891 14.487,22.880 C13.989,22.872 13.708,22.631 13.715,22.104 C13.722,21.639 13.717,21.174 13.716,20.709 C13.716,20.244 13.725,19.779 13.713,19.315 C13.702,18.794 13.960,18.529 14.463,18.517 C15.113,18.501 15.763,18.507 16.412,18.513 C16.943,18.518 17.242,18.789 17.249,19.326 C17.262,20.232 17.262,21.138 17.251,22.045 C17.244,22.567 16.980,22.875 16.436,22.881 ZM15.470,19.651 C14.745,19.639 14.762,20.054 14.785,20.544 C14.793,20.706 14.803,20.870 14.784,21.030 C14.716,21.603 15.006,21.732 15.521,21.728 C16.318,21.720 16.042,21.142 16.104,20.780 C16.104,20.666 16.103,20.597 16.104,20.528 C16.113,20.078 16.168,19.663 15.470,19.651 ZM16.441,16.877 C15.789,16.872 15.136,16.873 14.484,16.877 C13.968,16.880 13.705,16.643 13.714,16.112 C13.723,15.646 13.716,15.179 13.715,14.712 C13.714,14.292 13.736,13.871 13.709,13.452 C13.670,12.835 13.944,12.527 14.552,12.519 C15.158,12.512 15.763,12.513 16.369,12.522 C16.927,12.530 17.244,12.810 17.249,13.382 C17.256,14.292 17.263,15.202 17.242,16.111 C17.231,16.606 16.961,16.882 16.441,16.877 ZM15.420,13.639 C14.715,13.650 14.777,14.063 14.786,14.513 C14.790,14.676 14.803,14.840 14.784,15.000 C14.712,15.612 15.028,15.764 15.571,15.727 C16.362,15.673 16.008,15.067 16.104,14.731 C16.104,14.630 16.102,14.584 16.104,14.538 C16.122,14.053 16.157,13.628 15.420,13.639 ZM17.230,10.189 C17.205,10.619 16.963,10.866 16.505,10.863 C15.808,10.858 15.111,10.861 14.414,10.862 C13.912,10.863 13.711,10.593 13.714,10.113 C13.720,9.183 13.721,8.252 13.714,7.321 C13.710,6.786 13.978,6.567 14.491,6.573 C15.141,6.582 15.792,6.585 16.443,6.573 C16.967,6.563 17.220,6.835 17.242,7.329 C17.264,7.793 17.247,8.259 17.247,8.724 C17.244,8.724 17.241,8.724 17.237,8.724 C17.237,9.213 17.259,9.702 17.230,10.189 ZM16.104,8.797 C16.104,8.671 16.103,8.602 16.104,8.532 C16.109,8.062 16.187,7.617 15.430,7.626 C14.659,7.635 14.794,8.108 14.787,8.558 C14.785,8.720 14.806,8.885 14.783,9.045 C14.692,9.696 15.021,9.838 15.596,9.797 C16.421,9.737 15.970,9.107 16.104,8.797 ZM11.604,10.870 C10.954,10.843 10.303,10.863 9.652,10.862 C9.199,10.861 8.962,10.638 8.961,10.179 C8.960,9.690 8.961,9.202 8.961,8.713 C8.974,6.319 8.683,6.584 11.061,6.574 C12.441,6.568 12.503,6.635 12.504,8.030 C12.505,8.682 12.506,9.333 12.497,9.984 C12.488,10.566 12.242,10.897 11.604,10.870 ZM11.308,7.889 C11.304,7.736 11.149,7.689 11.004,7.655 C10.224,7.473 10.032,7.680 10.039,8.717 C10.039,8.949 10.034,9.181 10.041,9.412 C10.049,9.719 10.253,9.809 10.512,9.785 C10.791,9.759 11.226,9.937 11.291,9.548 C11.382,9.009 11.325,8.443 11.308,7.889 ZM9.716,12.528 C10.367,12.510 11.019,12.514 11.671,12.528 C12.208,12.539 12.482,12.845 12.489,13.372 C12.500,14.258 12.503,15.145 12.492,16.031 C12.485,16.588 12.216,16.895 11.624,16.880 C11.019,16.866 10.412,16.863 9.807,16.882 C9.171,16.901 8.923,16.594 8.953,15.982 C8.973,15.563 8.957,15.142 8.957,14.722 C8.957,14.279 8.974,13.835 8.953,13.393 C8.928,12.844 9.173,12.543 9.716,12.528 ZM10.031,14.479 C10.040,14.641 10.030,14.804 10.033,14.966 C10.044,15.655 10.340,15.886 10.989,15.706 C11.570,15.545 11.253,15.052 11.349,14.760 C11.349,14.642 11.346,14.572 11.349,14.502 C11.367,14.040 11.394,13.646 10.701,13.639 C10.020,13.633 10.002,13.997 10.031,14.479 ZM7.862,28.107 C7.841,28.605 7.552,28.870 7.055,28.877 C6.406,28.887 5.756,28.890 5.106,28.876 C4.610,28.865 4.338,28.617 4.343,28.091 C4.351,27.161 4.352,26.231 4.342,25.302 C4.336,24.779 4.587,24.521 5.095,24.514 C5.745,24.505 6.395,24.514 7.045,24.508 C7.595,24.503 7.858,24.794 7.876,25.319 C7.891,25.760 7.879,26.202 7.879,26.643 C7.875,26.643 7.871,26.643 7.867,26.643 C7.867,27.131 7.884,27.620 7.862,28.107 ZM6.735,26.754 C6.735,26.652 6.733,26.606 6.735,26.560 C6.759,26.070 6.776,25.648 6.052,25.659 C5.358,25.669 5.407,26.085 5.418,26.538 C5.421,26.676 5.417,26.815 5.419,26.954 C5.427,27.672 5.733,27.913 6.410,27.706 C6.981,27.531 6.617,27.032 6.735,26.754 ZM7.071,10.867 C6.421,10.853 5.771,10.856 5.121,10.866 C4.607,10.874 4.339,10.655 4.343,10.121 C4.350,9.190 4.351,8.260 4.343,7.329 C4.338,6.800 4.594,6.567 5.112,6.574 C5.762,6.582 6.413,6.586 7.063,6.572 C7.586,6.561 7.845,6.826 7.869,7.321 C7.892,7.785 7.874,8.251 7.874,8.717 C7.875,9.182 7.892,9.648 7.870,10.112 C7.848,10.604 7.599,10.878 7.071,10.867 ZM6.695,7.889 C6.690,7.736 6.536,7.689 6.390,7.655 C5.610,7.473 5.418,7.680 5.426,8.717 C5.426,8.949 5.421,9.181 5.428,9.412 C5.436,9.719 5.640,9.809 5.899,9.785 C6.178,9.759 6.612,9.937 6.677,9.548 C6.768,9.009 6.712,8.443 6.695,7.889 ZM4.344,13.284 C4.336,12.828 4.563,12.561 5.002,12.545 C5.722,12.519 6.444,12.523 7.165,12.545 C7.606,12.559 7.852,12.842 7.861,13.272 C7.881,14.227 7.886,15.184 7.866,16.140 C7.856,16.598 7.601,16.874 7.111,16.874 C6.436,16.874 5.760,16.874 5.085,16.876 C4.555,16.877 4.331,16.598 4.342,16.083 C4.352,15.617 4.345,15.150 4.345,14.683 C4.346,14.217 4.352,13.750 4.344,13.284 ZM5.418,14.533 C5.424,14.671 5.417,14.811 5.419,14.950 C5.430,15.658 5.697,15.873 6.360,15.709 C6.955,15.562 6.642,15.067 6.735,14.775 C6.735,14.658 6.735,14.588 6.735,14.519 C6.741,14.072 6.811,13.652 6.104,13.640 C5.374,13.628 5.395,14.042 5.418,14.533 ZM5.085,18.518 C5.757,18.502 6.431,18.507 7.104,18.519 C7.575,18.527 7.849,18.790 7.858,19.256 C7.878,20.231 7.882,21.207 7.860,22.182 C7.850,22.616 7.570,22.864 7.135,22.874 C6.439,22.889 5.743,22.891 5.047,22.874 C4.571,22.863 4.335,22.597 4.343,22.112 C4.351,21.647 4.345,21.182 4.345,20.717 C4.345,20.253 4.353,19.787 4.342,19.323 C4.330,18.806 4.579,18.529 5.085,18.518 ZM6.074,21.736 C6.746,21.735 6.763,21.361 6.736,20.884 C6.728,20.723 6.718,20.559 6.738,20.399 C6.811,19.804 6.528,19.643 5.973,19.661 C5.159,19.686 5.509,20.287 5.418,20.622 C5.418,20.743 5.422,20.812 5.418,20.881 C5.391,21.354 5.397,21.736 6.074,21.736 ZM10.397,22.888 C10.143,22.888 9.886,22.892 9.632,22.874 C9.194,22.841 8.957,22.609 8.959,22.153 C8.962,21.176 8.960,20.200 8.962,19.224 C8.963,18.763 9.230,18.536 9.658,18.523 C10.353,18.503 11.050,18.507 11.746,18.522 C12.181,18.532 12.446,18.779 12.466,19.216 C12.490,19.726 12.472,20.237 12.472,20.748 C12.528,23.067 12.541,22.893 10.397,22.888 ZM11.349,20.857 C11.346,20.719 11.350,20.580 11.348,20.441 C11.339,19.726 11.025,19.481 10.354,19.691 C9.785,19.868 10.152,20.367 10.032,20.645 C10.032,20.746 10.034,20.793 10.032,20.839 C10.007,21.328 9.990,21.748 10.715,21.736 C11.410,21.724 11.358,21.308 11.349,20.857 ZM8.957,25.285 C8.949,24.804 9.175,24.531 9.656,24.520 C10.352,24.504 11.048,24.509 11.744,24.515 C12.188,24.519 12.460,24.765 12.471,25.197 C12.495,26.172 12.494,27.148 12.473,28.123 C12.462,28.626 12.144,28.872 11.653,28.879 C11.026,28.887 10.400,28.885 9.773,28.881 C9.198,28.877 8.930,28.587 8.954,28.005 C8.972,27.564 8.957,27.122 8.958,26.680 C8.959,26.215 8.965,25.750 8.957,25.285 ZM10.031,26.526 C10.036,26.665 10.031,26.804 10.033,26.943 C10.040,27.686 10.228,27.846 10.944,27.718 C11.617,27.598 11.226,27.050 11.349,26.764 C11.349,26.640 11.344,26.570 11.349,26.501 C11.385,26.013 11.336,25.657 10.676,25.659 C9.989,25.661 10.014,26.065 10.031,26.526 ZM13.717,26.625 C13.717,26.160 13.718,25.695 13.717,25.230 C13.715,24.771 13.961,24.533 14.399,24.522 C15.095,24.503 15.792,24.510 16.489,24.514 C16.972,24.517 17.229,24.797 17.239,25.253 C17.262,26.206 17.259,27.160 17.244,28.113 C17.238,28.577 16.976,28.856 16.505,28.869 C15.832,28.887 15.158,28.887 14.486,28.870 C13.951,28.857 13.688,28.574 13.711,28.020 C13.730,27.556 13.715,27.090 13.715,26.625 C13.716,26.625 13.716,26.625 13.717,26.625 ZM14.786,26.538 C14.789,26.677 14.785,26.816 14.787,26.955 C14.795,27.674 15.101,27.913 15.778,27.705 C16.348,27.530 15.986,27.031 16.104,26.753 C16.104,26.651 16.102,26.604 16.104,26.558 C16.129,26.067 16.140,25.648 15.419,25.658 C14.721,25.668 14.777,26.088 14.786,26.538 Z"/>
                            </svg>
                        </div>
                    </div>
                `;
      }
      $("#hosuseApertmentList").html(apertmentHtml);
      openMenus("#houseapartment", true);
      updateHouseData(event.data.houseData);
      break;
    case "houseSettings":
      houseSettings(event.data.houseSettings, event.data.houseSettingsPrice);
      break;
    case "updateHouseData":
      updateHouseData(event.data.houseData);
      break;
    case "setLang":
      lang = event.data.lang;
      for (const key in lang) {
        $("#" + key).html(lang[key]);
      }
      break;
  }
});

function openMenus(elem, blur) {
  $(elem).fadeIn();
  if (blur) {
    $(".bg").fadeIn();
  }
}

function updateHouseData(data) {
  houseData = data;
  if (!data.star) {
    data.star = 1;
  }

  $(".houseNameBox").html(`
        <div class="houseNameBoxIcon">
        <i class="fas fa-home"></i>
        </div>
        <div class="houseName">${houseData.name}</div>
        <div class="houseNameStar">
            <img src="img/${data.star}star.png" id="houseStar">
        </div>
    `);

  $("#price").html(
    houseData.price + `<div class='priceIcon'>${lang["dollar"]}</div>`
  );
  if (houseData.buyed && houseData.myHouse) {
    $("#houseSell").css("display", "flex");
    $("#houseSettingsBottom").css("display", "flex");
  } else {
    $("#houseSell").css("display", "none");
    $("#houseSettingsBottom").css("display", "none");
  }
  if (houseData.garage) {
    $("#inspectGarage").css("display", "flex");
  } else {
    $("#inspectGarage").css("display", "none");
  }
  if (houseData.isRealestate) {
    $("#buyHouse").css("display", "flex");
  } else {
    $("#buyHouse").css("display", "none");
  }
}

function inGarage(inGarageData) {
  if (inGarageData) {
    $("#houseGarage").css("display", "none");
    $("#houseHouse").css("display", "flex");
  } else {
    $("#houseGarage").css("display", "flex");
    $("#houseHouse").css("display", "none");
  }
}

$(".houseMenuClose").click(function () {
  closeAllMenu();
});

function closeAllMenu() {
  $("#buymenu").fadeOut();
  $("#housemenu").fadeOut();
  $("#housesettings").fadeOut();
  $(".areyousureMenu").fadeOut();
  $("#houseapartment").fadeOut();
  $(".bg").fadeOut();
  $.post("https://tgiann-house/disableNuiFocus");
}

$("#inspectHouse").click(function () {
  $("#buymenu").fadeOut();
  $(".bg").fadeOut();
  $.post(
    "https://tgiann-house/inspectHouse",
    JSON.stringify({ houseData: houseData })
  );
});

$("#inspectGarage").click(function () {
  $("#buymenu").fadeOut();
  $(".bg").fadeOut();
  $.post(
    "https://tgiann-house/inspectGarage",
    JSON.stringify({ houseData: houseData })
  );
});

$("#houseLeave").click(function () {
  $("#housemenu").fadeOut();
  $(".bg").fadeOut();
  $.post("https://tgiann-house/houseLeave");
});

$("#houseGarage").click(function () {
  $("#housemenu").fadeOut();
  $(".bg").fadeOut();
  $.post("https://tgiann-house/houseGarage");
});

$("#houseHouse").click(function () {
  $("#housemenu").fadeOut();
  $(".bg").fadeOut();
  $.post("https://tgiann-house/houseHouse");
});

$("#buyHouse").click(function () {
  const elem = $(".areyousureMenu");
  elem.data("type", "buy");
  elem.fadeIn();
});

$("#houseSell").click(function () {
  const elem = $(".areyousureMenu");
  elem.data("type", "sell");
  elem.fadeIn();
});

function houseSettings(settings, houseSettingsPrice) {
  if (settings) {
    $("#houseSettingsTop").css("display", "block");
    $("#settingsMenu").html("");
    for (const key in settings) {
      let settingsButton = `<div class="houseMenuSettingButton" id="settingsView">${lang["viewhtml"]}</div>`;
      if (houseData.buyed) {
        settingsButton += `<div class="houseMenuSettingButton" id="settingsBuy">${lang["buyhtml"]}</div> <div class="settingsBuyPrice">${houseSettingsPrice[key]}${lang["dollar"]}</div>`;
      }
      let option = "";
      for (let i = 0; i < settings[key].feature.length; i++) {
        option =
          option +
          `<option value="${settings[key].feature[i]}">${
            lang[settings[key].feature[i]]
          }</option>`;
      }
      const data = `
                <div class="houseMenuSetting">
                    <div class="houseMenuSettingLeft">
                        <div class="houseMenuSettingName">${lang[key]}</div>
                        <div class="houseMenuSettingSelect" id="${key}" data-price="${houseSettingsPrice[key]}" data-function="${settings[key].functionName}">
                            <select class="form-select" aria-label="Default select example">
                                ${option}
                            </select>
                        </div>
                    </div>
                    <div class="houseMenuSettingButtons">
                        ${settingsButton}
                    </div>
                </div>
            `;

      $("#settingsMenu").append(data);
    }
  } else {
    $("#houseSettingsTop").css("display", "none");
  }
  $("#housesettings").fadeIn();
}

$(document).on("click", "#settingsView", function (e) {
  const parent = $(this)
    .parent()
    .parent()
    .children(".houseMenuSettingLeft")
    .children(".houseMenuSettingSelect");
  const val = parent.find("option:selected").val();
  $.post(
    "https://tgiann-house/settingsView",
    JSON.stringify({
      val: val,
      name: parent.attr("id"),
      functionName: parent.data("function"),
      interior: houseData.interior,
    })
  );
});

$(document).on("click", "#settingsBuy", function (e) {
  const parent = $(this)
    .parent()
    .parent()
    .children(".houseMenuSettingLeft")
    .children(".houseMenuSettingSelect");
  const val = parent.find("option:selected").val();
  $.post(
    "https://tgiann-house/settingsBuy",
    JSON.stringify({
      val: val,
      name: parent.attr("id"),
      functionName: parent.data("function"),
      interior: houseData.interior,
      price: parent.data("price"),
    })
  );
});

$(document).on("click", "#areyousureno", function (e) {
  $(".areyousureMenu").fadeOut();
});

$(document).on("click", "#areyousureyes", function (e) {
  const elem = $(".areyousureMenu");
  const type = elem.data("type");
  if (type == "buy") {
    closeAllMenu();
    $.post(
      "https://tgiann-house/buyHouse",
      JSON.stringify({ houseData: houseData })
    );
  } else if (type == "sell") {
    closeAllMenu();
    $.post("https://tgiann-house/houseSell");
  } else if (type == "resetKey") {
    elem.fadeOut();
    $.post("https://tgiann-house/houseResetKey");
  } else if (type == "transfer") {
    closeAllMenu();
    $.post("https://tgiann-house/houseTransfer");
  }
});

$("#houseInvite").click(function () {
  $.post(
    "https://tgiann-house/houseInvite",
    JSON.stringify({ houseData: houseData })
  );
});

$("#houseGiveKey").click(function () {
  $.post("https://tgiann-house/houseGiveKey");
});

$("#houseResetKey").click(function () {
  const elem = $(".areyousureMenu");
  elem.data("type", "resetKey");
  elem.fadeIn();
});

$("#houseTransfer").click(function () {
  const elem = $(".areyousureMenu");
  elem.data("type", "transfer");
  elem.fadeIn();
});

$(document).on("click", ".apartmentButton", function (e) {
  const data = $(this).data("apart");
  $("#houseapartment").fadeOut(0);
  $(".bg").fadeOut(0);
  $.post(
    "https://tgiann-house/openApertment",
    JSON.stringify({ apart: data, houseData: houseData, inCar: apartInCar })
  );
});
